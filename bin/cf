#!/bin/sh
# Count entries in a given set of directories
self=cf

# Iterate over remaining non-option arguments (directories); default to current
# directory if none given
for dir in "${@:-.}" ; do

    # Warn if a non-directory was given, flag errors, but continue
    if ! [ -d "$dir" ] ; then
        printf >&2 '%s: %s: not a directory\n' \
            "$self" "$dir"
        ex=1
        continue
    fi

    # Count the files
    count=$(
        find "$dir" ! -path "$dir" -prune -exec printf %.sx {} + |
        wc -c
    )

    # Print the count and the dirname
    printf '%u\t%s\n' "$count" "$dir"
done

# Exit non-zero if a non-directory was given as an argument
exit "${ex:-0}"
