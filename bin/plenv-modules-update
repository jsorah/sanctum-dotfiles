#!/usr/bin/env bash

mf=$(mktemp) || exit
ef=$(mktemp) || exit
cf=$(mktemp) || exit
cleanup() {
    rm -f -- "$mf" "$ef" "$cf"
}
trap cleanup EXIT

plenv list-modules | LANG=C.UTF-8 sort > "$mf"
LANG=C.UTF-8 sort "$HOME"/.plenv/non-cpanm-modules > "$ef"
LANG=C.UTF-8 comm -23 -- "$mf" "$ef" > "$cf"

while read -r module ; do 
    cpanm --from http://cpan.inspire.net.nz --notest --quiet -- "$module"
done < "$cf"
